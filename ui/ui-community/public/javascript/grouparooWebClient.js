var GrouparooWebClient=function(e){var t={};function o(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,o),n.l=!0,n.exports}return o.m=e,o.c=t,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(r,n,function(t){return e[t]}.bind(null,n));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(1);e.exports=r.GrouparooWebClient,t.default=r.GrouparooWebClient},function(e,t,o){"use strict";var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(n,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function u(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,u)}a((r=r.apply(e,t||[])).next())}))},n=this&&this.__generator||function(e,t){var o,r,n,i,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,r&&(n=2&i[0]?r.return:i[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,i[1])).done)return n;switch(r=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(n=s.trys,(n=n.length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){s.label=i[1];break}if(6===i[0]&&s.label<n[1]){s.label=n[1],n=i;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(i);break}n[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{o=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.GrouparooWebClient=void 0;var i=o(2),s=o(3),u=o(4),a=function(){function e(e){if(!e)throw new Error("no arguments provided");for(var t in e)this[t]=e[t];this.queue=[],this.errorCount=0,this.validateAndApplyDefaults(),this.generateAnonymousId(),this.generateSessionId(),this.errorCount=0,this.userId?s.Cookie.set(this.userIdCookie,this.userId):this.userId=s.Cookie.get(this.userIdCookie)}return e.prototype.reset=function(e){this.userId=null,this.anonymousId=null,this.sessionId=null,s.Cookie.clear(this.anonymousIdCookie),s.Cookie.clear(this.sessionIdCookie),s.Cookie.clear(this.userIdCookie),this.eventsCounts={},e&&(this.anonymousId=e),this.generateAnonymousId(!1),this.generateSessionId(!1),this.queue=[],this.errorCount=0},e.prototype.track=function(e,t,o){return void 0===t&&(t={}),void 0===o&&(o=new Date),r(this,void 0,void 0,(function(){var r;return n(this,(function(n){return this.generateSessionId(),this.generateAnonymousId(),r={apiKey:this.apiKey,type:e,data:t,userId:this.userId,anonymousId:this.anonymousId,sessionId:this.sessionId,ocurredAt:o.getTime()},this.eventsCounts[e]++,this.queue.push(r),[2,this.processQueue()]}))}))},e.prototype.identify=function(e,t){return r(this,void 0,void 0,(function(){return n(this,(function(o){return this.userId=e,s.Cookie.set(this.userIdCookie,this.userId),[2,this.track("identify",t)]}))}))},e.prototype.page=function(e,t,o){return r(this,void 0,void 0,(function(){return n(this,(function(r){return[2,this.track("page",Object.assign({category:e,title:t||window.document.title,href:window.location.href,pathname:window.location.pathname,referrer:window.document.referrer},u.queryParams(),o))]}))}))},e.prototype.processQueue=function(){return r(this,void 0,void 0,(function(){var e,t;return n(this,(function(o){switch(o.label){case 0:return this.processing?[2]:(this.processing=!0,(e=this.queue.shift())?[4,this.sendEvent(e)]:(this.processing=!1,[2]));case 1:return t=o.sent(),this.processing=!1,t?[2]:[2,this.processQueue()]}}))}))},e.prototype.sendEvent=function(e){return r(this,void 0,void 0,(function(){var t,o,r,i;return n(this,(function(n){switch(n.label){case 0:t=""+this.host+this.path,n.label=1;case 1:return n.trys.push([1,4,,5]),[4,fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})];case 2:return[4,(o=n.sent()).json()];case 3:if(r=n.sent(),!o.ok)throw r.error.message?r.error.message:r.error;return this.log(JSON.stringify(e),t,": "+o.status),[3,5];case 4:return i=n.sent(),this.reportError(i),this.retryFailedFetch(e),[2,i];case 5:return[2]}}))}))},e.prototype.retryFailedFetch=function(e){return r(this,void 0,void 0,(function(){var t=this;return n(this,(function(o){return this.errorCount++,this.errorCount>=this.maxErrorCount?[2,console.error("[grouparoo] MaxErrorCount ("+this.maxErrorCount+") reached.  Not retrying.")]:(this.queue.push(e),clearTimeout(this.retryTimer),this.retryTimer=setTimeout((function(){t.processQueue()}),this.retrySleep),[2])}))}))},e.prototype.validateAndApplyDefaults=function(){if(!this.apiKey)throw new Error("apiKey is a required argument");if(!this.host)throw new Error("host is a required argument");this.path||(this.path="/api/v1/track"),this.userIdCookie||(this.userIdCookie="grouparoo-user-id"),this.anonymousIdCookie||(this.anonymousIdCookie="grouparoo-anonymous-id"),this.anonymousIdCookieTTL||(this.anonymousIdCookieTTL=7776e6),this.sessionIdCookie||(this.sessionIdCookie="grouparoo-session-id"),this.sessionIdCookieTTL||(this.sessionIdCookieTTL=36e5),this.logging||(this.logging=!1),this.errorHandlers||(this.errorHandlers=[this.logError]),this.retrySleep||(this.retrySleep=3e3),this.maxErrorCount||(this.maxErrorCount=10),this.processing=!1,this.eventsCounts={}},e.prototype.generateAnonymousId=function(e){var t;return void 0===e&&(e=!0),t=this.anonymousId?this.anonymousId.toString():e&&s.Cookie.get(this.anonymousIdCookie)?s.Cookie.get(this.anonymousIdCookie):"aid-"+i.uuid.v4(),this.anonymousId=t,s.Cookie.set(this.anonymousIdCookie,this.anonymousId,this.anonymousIdCookieTTL),t},e.prototype.generateSessionId=function(e){var t;return void 0===e&&(e=!0),t=this.sessionId?this.sessionId.toString():e&&s.Cookie.get(this.sessionIdCookie)?s.Cookie.get(this.sessionIdCookie):"sid-"+i.uuid.v4(),this.sessionId=t,s.Cookie.set(this.sessionIdCookie,this.sessionId,this.sessionIdCookieTTL),t},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.logging&&console.log("[grouparoo] "+e.join(" "))},e.prototype.reportError=function(e){this.errorHandlers.map((function(t){return t(e)}))},e.prototype.logError=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.error("[grouparoo] "+e.join(" "))},e}();t.GrouparooWebClient=a},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uuid=void 0,function(e){e.v4=function(){return globalThis.crypto?([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(function(e){return(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)})):"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}}(t.uuid||(t.uuid={}))},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Cookie=void 0,function(e){e.set=function(e,t,o){var r="";if(o){var n=new Date;n.setTime(n.getTime()+o),r="; expires="+n.toUTCString()}window.document.cookie=e+"="+(t.toString()||"")+r+"; path=/"},e.get=function(e){for(var t=e+"=",o=window.document.cookie.split(";"),r=0;r<o.length;r++){for(var n=o[r];" "==n.charAt(0);)n=n.substring(1,n.length);if(0==n.indexOf(t)){var i=n.substring(t.length,n.length);return i&&""!==i?i:null}}return null},e.clear=function(e){window.document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/"}}(t.Cookie||(t.Cookie={}))},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.queryParams=void 0,t.queryParams=function(){for(var e,t=/\+/g,o=/([^&=]+)=?([^&]*)/g,r=function(e){return decodeURIComponent(e.replace(t," "))},n=window.location.search.substring(1),i={};e=o.exec(n);)i[r(e[1])]=r(e[2]);return i}}]);