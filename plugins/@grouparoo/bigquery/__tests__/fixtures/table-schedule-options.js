const nock = require("nock");
process.env.BIGQUERY_JEST_TIMESTAMP = "1588888800425";

nock("https://www.googleapis.com:443", { encodedQueryParams: true })
  .post("/oauth2/v4/token", {
    grant_type: "urn:ietf:params:oauth:grant-type:jwt-bearer",
    assertion: /.+/g,
  })
  .once()
  .reply(
    200,
    [
      "1f",
      "8b",
      "08",
      "00",
      "00",
      "00",
      "00",
      "00",
      "02",
      "ff",
      "1d",
      "cf",
      "db",
      "6e82300000d07fe9b318ca45616fdcc25606c1ae0cf185345010945b41b42efbf7999d3f383f8016059be77c192eac076f4050c5dc16db60306c511782d0496d4918e94c62b5e8bdf80cf1f196fbfb0e3d569866575aa14c4d4b074685435cff86e6601257a75ed63e29bbb1869d9a1ad9c0b1fe1c7614a35053b2b35499074ba17185efb175b808dd0dbdf953a0417f6fbf6db25a838da5ec84082b2197ef79bc8372b587b6148d49a21de15750f42332da856bb09bac45c60da9f8d8e1b0f50cffe3e41a96e9810d608fb1e16cce9bd74cd54d7303fe9bf92246f6bada8c72c6c1ef1fd9f137fa05010000",
    ],
    [
      "Content-Type",
      "application/json; charset=UTF-8",
      "Vary",
      "Origin",
      "Vary",
      "X-Origin",
      "Vary",
      "Referer",
      "Content-Encoding",
      "gzip",
      "Date",
      "Thu, 07 May 2020 22:00:01 GMT",
      "Server",
      "scaffolding on HTTPServer2",
      "Cache-Control",
      "private",
      "X-XSS-Protection",
      "0",
      "X-Frame-Options",
      "SAMEORIGIN",
      "X-Content-Type-Options",
      "nosniff",
      "Alt-Svc",
      'h3-27=":443"; ma=2592000,h3-25=":443"; ma=2592000,h3-T050=":443"; ma=2592000,h3-Q050=":443"; ma=2592000,h3-Q049=":443"; ma=2592000,h3-Q048=":443"; ma=2592000,h3-Q046=":443"; ma=2592000,h3-Q043=":443"; ma=2592000,quic=":443"; ma=2592000; v="46,43"',
      "Connection",
      "close",
      "Transfer-Encoding",
      "chunked",
    ]
  );
nock("https://bigquery.googleapis.com:443", { encodedQueryParams: true })
  .post("/bigquery/v2/projects/sample-sources/jobs", {
    configuration: {
      query: {
        useLegacySql: false,
        query:
          "SELECT column_name, data_type FROM `test`.INFORMATION_SCHEMA.COLUMNS WHERE table_name = @tableName",
        defaultDataset: { datasetId: "test" },
        parameterMode: "named",
        queryParameters: [
          {
            parameterType: { type: "STRING" },
            parameterValue: { value: "purchases" },
            name: "tableName",
          },
        ],
      },
    },
    jobReference: {
      projectId: "sample-sources",
      jobId: "grouparoo-job-1-1588888800425",
    },
  })
  .once()
  .reply(
    200,
    [
      "1f",
      "8b",
      "08",
      "00",
      "00",
      "00",
      "00",
      "00",
      "02",
      "ff",
      "8d",
      "54",
      "6b",
      "6f",
      "9b",
      "30",
      "14",
      "fd",
      "9e",
      "5f81d8d726214f68a5688d12b222256423a4d94313b58da1ee08a6d864aaaafcf7d9260f58aa6ef914ee3de7dc73afaffddad034fd174943fd46d321899f0b9cbf7c78a250bf9219cc412c335f97ecfb0c16b6b179b636bbf16631ec86ce78342a5144b119d866096e325ae408b39bf5aa15e7b4c8404e695308363bcdcec0523fc3e877072595e1249a93f4971478e43c6337edf6d1462ba6344e30c8086b21ba3dc5dbbb6e3bcbe913469cb5eb55dba2106bbf5bf7634211e084a6a3f5aaf450309c07780b48225d9cc921bcadabb708d8b66281de11840142b448b97456ca209a46242e72252e945e45508495e5d36725a0afecb93df1354493629b0629d8e22b2d041c04fc25c3dacc5b2eb4078e197f6839ee6ce92dc6beb37483d5e4ce5e8c5b93e57cbd7057dae6cef66c8d03986025a18db45bf5e58a0f654c150d850e4995355f662b8644f6304de78d733c494811618ee1032c308d21e858c6358ca08922ab3780918121b4a039003d68a0eb3eee871083aa827256f2414ad3d034a3bed9e907211c82a08f8728b060d40b423334bb0688422b34f4037b7fea05e518703c252ca38c1c86ad4f3c7becdb81330b5cdb9edad373ebbf737281de788e00fbdeda9d0856754c1128123e2d1bad0fa9d6bd3c976a63ef4df0a2812c275498524be0b8beed8d27be735fb12136728e63805e56cf72272390307c66835c1c2dc7f98286f21c7577bca8f6abf6ebf311c404e2c7c9e7b91d0194eba27ab958977a1d5fac636d14e55196517de57b8efb49af24f76fcbdc",
      "83a47843677708eb9998d6a39830ab6935fefef7b351a9a18b0b7eb0a77f59dbde37c9553999f17084739ca273d5ffd874492cd3ff7ebe04faf89a488278504ee519176171e7103b17578b2b6f2029077f12ec1ad6f028288839bf44f4bae61171f1a2c85a788b537e1c45f9b29473dcd72c15153b8a26e1e21ab88733dc37f68d3f6542895014060000",
    ],
    [
      "ETag",
      "XOsZFbuE0Wq8WvAWM62dIA==",
      "Content-Type",
      "application/json; charset=UTF-8",
      "Vary",
      "Origin",
      "Vary",
      "X-Origin",
      "Vary",
      "Referer",
      "Content-Encoding",
      "gzip",
      "Date",
      "Thu, 07 May 2020 22:00:02 GMT",
      "Server",
      "ESF",
      "Cache-Control",
      "private",
      "X-XSS-Protection",
      "0",
      "X-Frame-Options",
      "SAMEORIGIN",
      "X-Content-Type-Options",
      "nosniff",
      "Alt-Svc",
      'h3-27=":443"; ma=2592000,h3-25=":443"; ma=2592000,h3-Q050=":443"; ma=2592000,h3-Q049=":443"; ma=2592000,h3-Q048=":443"; ma=2592000,h3-Q046=":443"; ma=2592000,h3-Q043=":443"; ma=2592000,quic=":443"; ma=2592000; v="46,43"',
      "Transfer-Encoding",
      "chunked",
    ]
  );
nock("https://bigquery.googleapis.com:443", { encodedQueryParams: true })
  .get(
    "/bigquery/v2/projects/sample-sources/queries/grouparoo-job-1-1588888800425"
  )
  .query({ location: "US" })
  .once()
  .reply(
    200,
    [
      "1f",
      "8b",
      "08",
      "00",
      "00",
      "00",
      "00",
      "00",
      "02",
      "ff",
      "c5",
      "54",
      "5d",
      "6f8230147de75798ee551358fcda121f70731b993a454c962dc654b8280a94b565c618fffbda82ca8b0bc94cc603edbde7dc9ef4b6a77bad52419b20f6d07d052d82e5570a7477b3043e96131b581a72268684c40c5055b281e3a5648f3edec7c9a64d53431fbf4651ec6def5abad9e9642ce6ae20c282b7179188fd00428f89f853c5953cafb01847205774499846f15c85d533cc778982278e6d0d9f8b48443c850ca7fdbed9edf7500e1daa97453cccf15c2df9370935ceb45c0cadc9c2061f28c42e9c779d50b206975baabd0c474908354652ea02cb456461062f2949134c09a98954cda8198db6fa74bd7edb38b243e2621e9058164c27e824cf09c7a14db6b2c3a8991d01cdc2ace1c74e20bf7006c50609e85b16071e3ae50ed55f88d6d069d60bdc7c36d30a95a55545a3fc2084f93fa98b13596171c1cb69e7b7e44ae2382269cc4b4a3ff5dfcc2b6e5c98a1eca61f4da7772d59c685154aea3ad6a03771ccc1e8a2b8f8cfce26e8ee38b01125c2620c94b10cbdde6eb49a3a3a1af581482372e9534e535069178b07eb25e022e7e3908176d07e00add090be1c050000",
    ],
    [
      "ETag",
      "PZXQpk8ru10QKmmndw970A==",
      "Content-Type",
      "application/json; charset=UTF-8",
      "Vary",
      "Origin",
      "Vary",
      "X-Origin",
      "Vary",
      "Referer",
      "Content-Encoding",
      "gzip",
      "Date",
      "Thu, 07 May 2020 22:00:02 GMT",
      "Server",
      "ESF",
      "Cache-Control",
      "private",
      "X-XSS-Protection",
      "0",
      "X-Frame-Options",
      "SAMEORIGIN",
      "X-Content-Type-Options",
      "nosniff",
      "Alt-Svc",
      'h3-27=":443"; ma=2592000,h3-25=":443"; ma=2592000,h3-Q050=":443"; ma=2592000,h3-Q049=":443"; ma=2592000,h3-Q048=":443"; ma=2592000,h3-Q046=":443"; ma=2592000,h3-Q043=":443"; ma=2592000,quic=":443"; ma=2592000; v="46,43"',
      "Transfer-Encoding",
      "chunked",
    ]
  );
nock("https://bigquery.googleapis.com:443", { encodedQueryParams: true })
  .post("/bigquery/v2/projects/sample-sources/jobs", {
    configuration: {
      query: {
        useLegacySql: false,
        query: "SELECT * FROM `purchases` ORDER BY RAND() LIMIT 10",
        defaultDataset: { datasetId: "test" },
      },
    },
    jobReference: {
      projectId: "sample-sources",
      jobId: "grouparoo-job-2-1588888800425",
    },
  })
  .once()
  .reply(
    200,
    [
      "1f",
      "8b",
      "08",
      "00",
      "00",
      "00",
      "00",
      "00",
      "02",
      "ff",
      "8d",
      "53",
      "5b",
      "6f",
      "9b",
      "30",
      "14",
      "7e",
      "cfaf40ec659b964048489348d5d6055aa1a5a94ac8a6f685dace81ba014cb1c99655fdefb32117a24cdd78c3e77c97737b69699abea2d9521f6b3aa6f17309c5e6dd13c3fa271501816215f976b9f2d6f7f7e9af622536ecf71a82ecc9b93d3fafb36885e628cd136873561604f87831efc4052b735430d696846dabddb587d5679a7dcbaea11c92684ab39522781422e763c3d8d9e8c48cc509a09cf20e61e9fedd585b465eb02720821bc7aa8614e2c69bba9f134690a02c3b5fcc6b0f2587228414d144b9388097f8cb317b87a2b413cbec3525800861652694b39a86b02ca2715954e492e9453ecae7caf2feb7f1a0cfdda93b09b48fdaa57f73ad3de452e31171e00fda8defb8bef6f54ef32f66cefb0fdad4bbf602ad6b564215c912b8a0592515209c40434046b7ddf1fe32973d85224142ea6dd3c2337380ba437384237c46a261cfc69109180ff1998d7ad824a33ef4971850934128ed1a8f32960d30061bf549d8ed47ddb0bf1c2c43d4ebe170645a9645ecc1d026a6be45bfee6b210520010ee539e374db3c7de2bb17811b7a97e1cc751dd73994feb3a027d93f7c4f2607fe623691a8669b225426c2a90b3d6ed251f542f6b359d85b1d3c29202f2893a6aaa17ab3c0f52f2681f7bd61436ed814624436f367b563114a38b41a1cbadcd36093ab29eab70bd7bf531a554c457c88a0808c1c86fc1f0356c03afcef2b94d9bba3500079177b792ee4b35c35c20fe2d5bcd4e2d1b472bc27ec9983e18e50020b719a61f5babb8c93c3505a90422676ada80fa4eef7eb91a5b261a782a9",
      "7439fd9937bbaaccb75e5b7f009d14e793db040000",
    ],
    [
      "ETag",
      "KFkIvZZmxrktyozveTnjDQ==",
      "Content-Type",
      "application/json; charset=UTF-8",
      "Vary",
      "Origin",
      "Vary",
      "X-Origin",
      "Vary",
      "Referer",
      "Content-Encoding",
      "gzip",
      "Date",
      "Thu, 07 May 2020 22:00:03 GMT",
      "Server",
      "ESF",
      "Cache-Control",
      "private",
      "X-XSS-Protection",
      "0",
      "X-Frame-Options",
      "SAMEORIGIN",
      "X-Content-Type-Options",
      "nosniff",
      "Alt-Svc",
      'h3-27=":443"; ma=2592000,h3-25=":443"; ma=2592000,h3-Q050=":443"; ma=2592000,h3-Q049=":443"; ma=2592000,h3-Q048=":443"; ma=2592000,h3-Q046=":443"; ma=2592000,h3-Q043=":443"; ma=2592000,quic=":443"; ma=2592000; v="46,43"',
      "Transfer-Encoding",
      "chunked",
    ]
  );
nock("https://bigquery.googleapis.com:443", { encodedQueryParams: true })
  .get(
    "/bigquery/v2/projects/sample-sources/queries/grouparoo-job-2-1588888800425"
  )
  .query({ location: "US" })
  .once()
  .reply(
    200,
    [
      "1f",
      "8b",
      "08",
      "00",
      "00",
      "00",
      "00",
      "00",
      "02",
      "ff",
      "cd",
      "57",
      "5d",
      "6f",
      "da",
      "30",
      "147de757a0ec15981312924cea43d8b28e0e6807a9b6694293090652429cdace2a54f1dfe73881a2895517914af090c4d7f7e3707cece43ed7ea756d152533ed435d9b468bc78cb0cdbb0511dff28711e1592cb8bca534e1446be4de44e045ee3db8f98ebc1f37ab9fef094e56e9c6fcda59b6bdababc28b874bb2c6d2ef598ee4781e9178c6e5f8971ad74bbb9a4bf09ae419a3998a2dad62932a6b6f18f8d7fee8706a4d676a6a78dfef7bddbeaf9553dbc6ff93a78ccea398fc7edb22190b97b864ea9f12e360d41b5e9f5b01af69968863f93ff76fbde0dcf4332c8e82ffe405feb9b9b9c0ebf458f2a037f0c78137b8035550f749adaca53dd0e988cc092349485ee42657fb8184a2a774cd65dd98343995ab437859240f2ca6178c6629669436a5a9693475cb513f844cc3da79c734c422a2491e703fd6f6e50515381ed1a75cda9a8e0af1b3625c487dc784363f50ff214172ea8f8ab6b5bd6ddb78c5b10df41b0b869fa684b10d30c06821a82732501349aea098f596e5e8aea95baee9bb0731e5d3a4769001cc98052c0ef5f352a913e822b474f344b21014474e16729169574916142dd4af1b67e434711950e1ee098362518439bad3ae923028da0bda8e088a451166b775b74ac274075afd722406c72c19934176b58c4199b824c6c098f323df34a4c8aa64acea63ec94335ffea353cf7c305ec556c7312a3dc274030af732de9060bc8a2d0bb9957e4e742ade8cb70c270bb8b64cf062ed4e7b3060f53de1ead5eec4aadf8f6f4d171870212ea9ad57e992d7c94b0bd0dd08c2ef18950d0627aaad703bb6b6eb503ed2bc03117983",
      "2258469439c4b245fe1209699be39893dab6f617a376eab08e0f0000",
    ],
    [
      "ETag",
      "MJW0AXJkY/eankpy4K6h3A==",
      "Content-Type",
      "application/json; charset=UTF-8",
      "Vary",
      "Origin",
      "Vary",
      "X-Origin",
      "Vary",
      "Referer",
      "Content-Encoding",
      "gzip",
      "Date",
      "Thu, 07 May 2020 22:00:03 GMT",
      "Server",
      "ESF",
      "Cache-Control",
      "private",
      "X-XSS-Protection",
      "0",
      "X-Frame-Options",
      "SAMEORIGIN",
      "X-Content-Type-Options",
      "nosniff",
      "Alt-Svc",
      'h3-27=":443"; ma=2592000,h3-25=":443"; ma=2592000,h3-Q050=":443"; ma=2592000,h3-Q049=":443"; ma=2592000,h3-Q048=":443"; ma=2592000,h3-Q046=":443"; ma=2592000,h3-Q043=":443"; ma=2592000,quic=":443"; ma=2592000; v="46,43"',
      "Transfer-Encoding",
      "chunked",
    ]
  );
